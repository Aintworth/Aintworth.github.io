<html>

    <head>

        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    </head>

    <body>
        <label> Provinsi </label>
        <select class="select2-data-array browser-default" id="select2-provinsi"></select>
        <label> Kabupaten </label>
        <select class="select2-data-array browser-default" id="select2-kabupaten"></select>
    </body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        var urlProvinsi = "https://ibnux.github.io/data-indonesia/propinsi.json";
        var urlKabupaten = "https://ibnux.github.io/data-indonesia/kabupaten/";

        console.log('url: ' + urlProvinsi);
        $.getJSON(urlProvinsi, function (res) {
            console.log("INSIDE FUNC");
            //console.log(res);

            var data = $.map(res, function (obj) {
                obj.text = obj.nama

                return obj;
            });
            //console.log(data);
            loadProvinsi(data);
        });

        function fetchDataKabupaten(idProvinsi) {
            let url = urlKabupaten + idProvinsi + ".json";
            console.log('url kab : ' + url);
            $.getJSON(url, function (res) {
                console.log("INSIDE fetchDataKabupaten");
                //console.log(res);

                var data = $.map(res, function (obj) {
                    obj.text = obj.nama

                    return obj;
                });
                //console.log(data);
                loadKabupaten(data);
            });
        }


        function loadProvinsi(data) {
            console.log('loadProvinsi');
            $("#select2-provinsi").select2({
                dropdownAutoWidth: true,
                width: '100%',
                data: data
            })
        };

        function loadKabupaten(data) {
            console.log('loadKabupaten');
            $("#select2-kabupaten").select2({
                dropdownAutoWidth: true,
                width: '100%',
                data: data
            })
        };

        function clearOptions(id) {
            console.log("on clearOptions");

            //$('#' + id).val(null);
            $('#' + id).empty().trigger('change');
        }

        var selectProv = $('#select2-provinsi');
        $(selectProv).change(function () {
            console.log("on change selectProv");

            var value = $(selectProv).val();
            var text = $('#select2-provinsi :selected').text();
            console.log("value = " + value + " / " + "text = " + text);

            clearOptions('select2-kabupaten');
            dataKabupaten = fetchDataKabupaten(value);
            loadKabupaten(dataKabupaten);

        });

        var selectKab = $('#select2-kabupaten');
        $(selectKab).change(function () {
            console.log("on change selectKab");

            var value = $(this).val();
            var text = $('#select2-kabupaten :selected').text();
            console.log("value = " + value + " / " + "text = " + text);
        });
    </script>

</html>